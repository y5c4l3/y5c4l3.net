<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:url" content="https://y5c4l3.net/2023/08/19/recovering-rsa-key-pair-with-cado-nfs/">
  <meta property="og:site_name" content="Y5C4L3">
  <meta property="og:title" content="Recovering RSA-512 Key Pair with Distributed CADO-NFS">
  <meta property="og:description" content="Intro RSA is currently the most widely used public-key cryptosystem in the world. In public-key cryptography, there are two kinds of keys: private keys and public keys. Private keys are generated by some algorithm and need to be kept secret by the operator. Public keys are directly derived from private keys and can be published publicly anywhere. A public key together with the private key which it‚Äôs derived from is called a key pair.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2023-08-19T00:00:00+00:00">
    <meta property="article:modified_time" content="2023-08-19T00:00:00+00:00">
    <meta property="article:tag" content="Cryptography">
    <meta property="article:tag" content="Rsa">
    <meta property="article:tag" content="Cado-Nfs">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Recovering RSA-512 Key Pair with Distributed CADO-NFS">
  <meta name="twitter:description" content="Intro RSA is currently the most widely used public-key cryptosystem in the world. In public-key cryptography, there are two kinds of keys: private keys and public keys. Private keys are generated by some algorithm and need to be kept secret by the operator. Public keys are directly derived from private keys and can be published publicly anywhere. A public key together with the private key which it‚Äôs derived from is called a key pair.">

  
  


  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#262d33">
  <title>
    
    Y5C4L3 - Recovering RSA-512 Key Pair with Distributed CADO-NFS
    
  </title>
  
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
  
  
  
  <link rel="stylesheet" href="/minima.1719054160.css">
  
  
  <script defer type="text/javascript" src="/minima.1719054160.js"></script>
  
	
	<link rel="alternate" hreflang="zh-cn" href="https://y5c4l3.net/zh-cn/2023/08/19/recovering-rsa-key-pair-with-cado-nfs/" title="ZH">
	

</head>
<script>
  
  let default_theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';

  try {
    const local = localStorage.getItem('theme')
    if (local) {
      default_theme = local
    }
    localStorage.setItem('theme', default_theme);
    window.minima_theme = default_theme;
    document.querySelector('html').classList.add(default_theme);
  } catch (e) {
    console.error(e);
  }
</script>



<body>
  <header class="mt-3 mb-6">
  <div class="container mx-auto">
    <nav class="flex justify-between items-center">
      <div class="flex items-center">
        
        <div id="theme-switch" class="text-3xl cursor-pointer">üåù</div>
      </div>
      <ul class="flex items-center font-medium
        whitespace-nowrap overflow-x-auto overflow-y-hidden">
        
        <li class="ml-1 mr-1"><a href="/">Home</a></li>
        
        <li class="ml-1 mr-1"><a href="/about">About</a></li>
        
        <li class="ml-1 mr-1"><a href="/archive">Archive</a></li>
        
        <li class="ml-1 mr-1"><a href="/tags">Tags</a></li>
        
        <li class="ml-1 mr-1"><a href="/series">Series</a></li>
        
        <li class="ml-1 mr-1"><a href="/writing-guidelines">Guidelines</a></li>
        
      </ul>
      <ul class="flex item-center text-sm font-bold">
        
        <li class="ml-2"><a href="https://y5c4l3.net/">EN</a></li>
        
        <li class="ml-2"><a href="https://y5c4l3.net/zh-cn/">ZH</a></li>
        
      </ul>
    </nav>
  </div>
</header>

  
<div class="container mx-auto">
  <h1 class="text-4xl font-extrabold mt-6 mb-6">Recovering RSA-512 Key Pair with Distributed CADO-NFS</h1>
  <div class="mb-3 text-sm flex justify-between ">
    <div>
      
      Post at &mdash; Aug 19, 2023
      
      
    </div>
    
    <div>
      
      
      <a class="ml-1" href="/tags/cryptography">#cryptography</a>
      
      
      <a class="ml-1" href="/tags/rsa">#rsa</a>
      
      
      <a class="ml-1" href="/tags/cado-nfs">#cado-nfs</a>
      
    </div>
    
  </div>
  <main class="mb-8">
    <p></p>
    <article class="md">
      <h1 id="intro">Intro</h1>
<p><abbr title="Rivest‚ÄìShamir‚ÄìAdleman">RSA</abbr> is currently the most widely used public-key cryptosystem in the world. In public-key cryptography, there are two kinds of keys: private keys and public keys. Private keys are generated by some algorithm and need to be kept secret by the operator. Public keys are directly derived from private keys and can be published publicly anywhere. A public key together with the private key which it&rsquo;s derived from is called a key pair.</p>
<p>The key size of a key pair in RSA refers to the expected length (in bits) of the generated RSA modulus. It determines the overall security of the key pair. As of August 2023, the recommended least key size is 2048 bits. Unfortunately, some developers don&rsquo;t take best practices for security consideration and are still using 512-bit RSA keys.</p>
<p>This article demonstrates recovery of the private key (<abbr title="Public-Key Cryptography Standards">PKCS</abbr>#1 / PKCS#8 format) from an already known RSA-512 public key by factorizing RSA modulus with CADO-NFS.</p>
<p><em><strong>Disclaimer</strong>: This article is intended for educational purposes only. The author does not condone or encourage any illegal activities. The information provided in this article is for informational purposes only and should not be used for any illegal activities. The author is not responsible for any misuse of the information provided in this article.</em></p>
<h1 id="review-on-rsa">Review on RSA</h1>
<h2 id="formalization">Formalization</h2>
<ul>
<li>
<p>Choose two primes $p, q$ and $N:=pq$ is the modulus for the key pair.</p>
</li>
<li>
<p>Compute $\lambda(N)=\lambda(pq)=\operatorname{lcm}(p-1,q-1)$.</p>
<p>Here $\lambda(n)$ is <a href="https://en.wikipedia.org/wiki/Carmichael_function">Carmichael&rsquo;s totient function</a>, defined as $\eqref{carmichael}$.</p>
<p>$$
\begin{equation}
\lambda(n):=\min\{m&gt;0: \forall a \in{}\mathbf{R}^*_n, a^m\equiv 1\pmod n\}\label{carmichael}
\end{equation}
$$</p>
<p>where $\mathbf{R}^*_{n}{}:= \{i\in{}\mathbf{R}_n: \gcd(n, i) = 1\}$ is the reduced residue system modulo $n$.</p>
<p>Many textbooks are instead using <a href="https://en.wikipedia.org/wiki/Euler%27s_totient_function">Euler&rsquo;s totient function</a> $\varphi(n)$. This does not affect the correctness.</p>
</li>
<li>
<p>Choose a public exponent $e\neq 1$ so that $e\in{}\mathbf{R}^*_{\lambda(n)}$, namely $e$ is coprime to $\lambda(n)$.</p>
</li>
<li>
<p>Compute the private exponent $d:\equiv e^{-1}\pmod{\lambda(n)}$.</p>
</li>
<li>
<p>For end-to-end encryption: the encryptor $E(m):\equiv m^e\pmod N$ and the decryptor $D(m):\equiv m^d\pmod N$.</p>
</li>
<li>
<p>For signing purposes: the signer $\DeclareMathOperator*{\concat}{\Vert} S(m):=D( \operatorname{hash}(m))$</p>
</li>
</ul>
<p>I am not giving any proof of correctness here since it&rsquo;s a bit off-topic, but you can see the proof written by Stein in his book <em>Elementary Number Theory: Primes, Congruences, and Secrets</em> <a href="https://wstein.org/ent/ent.pdf">here</a>.</p>
<p>The formalization here is quite pedantic, there are much <a href="https://en.wikipedia.org/wiki/RSA_(cryptosystem)#Security_and_practical_considerations">more</a> restrictions in real life implementations, like the moderate distance between $p,q$, requirement on $e&gt;2$ and the usage of fixed value $e:=65537$ in common libraries.</p>
<h2 id="components-in-real-life">Components in Real Life</h2>
<p>The tuple $(p, q, e)$ can uniquely determines an RSA key pair, this is quite obvious from the steps above. In theory a private key COULD be $(p, q, d)$ and the derived public key is thus $(N, e)=(pq, e)$. It&rsquo;s also feasible to take $(p, q, e)$ as the private key tuple.</p>
<p>From mathematical context, the form of components is not unique but they are equivalent. So what stuff are actually stored in modern private key files? More specifically, what are the real components stored in PKCS#1 / PKCS#8? In fact, modern private key formats <strong>store components more than necessary, for space&ndash;time tradeoff.</strong></p>
<h3 id="private-key-components">Private Key Components</h3>
<p>Let&rsquo;s generate a random key and inspect its components via OpenSSL:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ openssl genrsa <span class="m">512</span> <span class="p">|</span> tee sample.key <span class="p">|</span> openssl pkey -noout -text
</span></span><span class="line"><span class="cl">Private-Key: <span class="o">(</span><span class="m">512</span> bit, <span class="m">2</span> primes<span class="o">)</span>
</span></span><span class="line"><span class="cl">modulus:
</span></span><span class="line"><span class="cl">    00:e8:b1:ea:27:bc:3a:a6:9f:53:48:24:9c:5a:9d:
</span></span><span class="line"><span class="cl">    9e:64:af:12:3e:ae:db:46:f0:4d:99:55:61:fd:c2:
</span></span><span class="line"><span class="cl">    c8:45:35:25:05:e6:7b:37:c0:cc:92:7a:45:c0:5b:
</span></span><span class="line"><span class="cl">    01:a3:4c:4e:87:5b:70:48:62:05:2a:6e:c2:3a:6a:
</span></span><span class="line"><span class="cl">    f0:07:92:61:ad
</span></span><span class="line"><span class="cl">publicExponent: <span class="m">65537</span> <span class="o">(</span>0x10001<span class="o">)</span>
</span></span><span class="line"><span class="cl">privateExponent:
</span></span><span class="line"><span class="cl">    00:ca:ec:5c:86:ca:5f:5b:6f:15:f1:93:fb:c6:0a:
</span></span><span class="line"><span class="cl">    2e:57:1f:55:89:d4:72:e5:2a:2a:81:cd:33:e7:58:
</span></span><span class="line"><span class="cl">    35:ce:23:20:af:2c:e6:fd:39:4e:2f:a6:be:23:23:
</span></span><span class="line"><span class="cl">    7f:e3:d2:f1:81:98:ef:48:91:a3:94:68:04:c6:a6:
</span></span><span class="line"><span class="cl">    d3:49:df:a8:01
</span></span><span class="line"><span class="cl">prime1:
</span></span><span class="line"><span class="cl">    00:f6:a8:8b:b4:cb:45:0f:d8:b9:6b:de:32:31:87:
</span></span><span class="line"><span class="cl">    c1:98:05:6d:d0:07:3d:c0:c0:8d:3d:5c:c1:1a:3a:
</span></span><span class="line"><span class="cl">    64:7d:45
</span></span><span class="line"><span class="cl">prime2:
</span></span><span class="line"><span class="cl">    00:f1:81:fc:ee:f1:5b:01:58:0c:0a:92:e2:fe:84:
</span></span><span class="line"><span class="cl">    17:f2:9d:f9:bb:e9:6a:4d:fd:77:56:37:32:76:68:
</span></span><span class="line"><span class="cl">    54:15:49
</span></span><span class="line"><span class="cl">exponent1:
</span></span><span class="line"><span class="cl">    00:c2:d9:14:3b:c6:d3:90:98:18:a9:c0:86:10:20:
</span></span><span class="line"><span class="cl">    78:eb:19:66:cd:0d:db:57:78:04:5a:f3:f9:cb:39:
</span></span><span class="line"><span class="cl">    53:86:ad
</span></span><span class="line"><span class="cl">exponent2:
</span></span><span class="line"><span class="cl">    32:ff:5e:f8:d9:f0:7c:ad:2a:05:c5:94:b7:68:0f:
</span></span><span class="line"><span class="cl">    62:85:27:6a:1d:d4:fb:d9:0d:2d:20:84:c0:6a:31:
</span></span><span class="line"><span class="cl">    6f:39
</span></span><span class="line"><span class="cl">coefficient:
</span></span><span class="line"><span class="cl">    00:bf:63:63:7b:71:73:ab:59:66:7d:2e:6f:eb:8a:
</span></span><span class="line"><span class="cl">    e3:88:a1:10:cb:db:5f:fb:d4:83:31:52:2d:97:6c:
</span></span><span class="line"><span class="cl">    38:29:50
</span></span></code></pre></td></tr></table>
</div>
</div><p>By default, <code>openssl genrsa</code> will generate keys in PKCS#8 format. This private key contains:</p>
<ul>
<li><strong>modulus</strong> corresponds to $N:=pq$</li>
<li><strong>publicExponent</strong> corresponds to $e$, OpenSSL always uses fixed value $e:=65537$ when generating new keys</li>
<li><strong>privateExponent</strong> corresponds to $d:\equiv e^{-1}\pmod{\lambda(n)}$</li>
<li><strong>prime1</strong> and <strong>prime2</strong> correspond to $p$ and $q$</li>
</ul>
<p>But who&rsquo;s giving <strong>exponent1</strong>, <strong>exponent2</strong>, <strong>coefficient</strong>?</p>
<h4 id="sped-up-exponentiation">Sped-up Exponentiation</h4>
<p>The point of these three unknown components is to make the decryptor</p>
<p>$$
D(m):\equiv m^d\pmod N
$$</p>
<p>and the signer $S(m)$ faster by <a href="https://en.wikipedia.org/wiki/Chinese_remainder_theorem">Chinese remainder theorem</a>.</p>
<p>In general this is actually an algorithm to compute modulus exponentiation for big numbers. Since the multiplication for big ones is not trivial operation (Karatsuba, FFT etc.) thus cannot be treated as $O(1)$, it is commonly implemented by some library.</p>
<p>Computing $m^d\pmod N$ is equivalent to solving $\eqref{crt-1}$, which is trivially solvable,</p>
<p>$$
\begin{equation}
x\equiv m^d\pmod{pq}\label{crt-1}
\end{equation}
$$</p>
<p>Since $p,q$ are primes, they are obviously coprime i.e. $\gcd(p,q)=1$. Justified by <abbr title="Chinese remainder theorem">CRT</abbr>, equation $\eqref{crt-1}$ can be rewritten equivalently into a system $\eqref{crt-2}$,</p>
<p>$$
\begin{equation}
\left\{
\begin{aligned}
x&amp;\equiv m^d\pmod{p} \\
x&amp;\equiv m^d\pmod{q}
\end{aligned}
\right.\label{crt-2}
\end{equation}
$$</p>
<p>Now the modulus $N$ has been halved (in digits) into $p,q$, hence the exponential part $d$ is able to be reduced.</p>
<p>For a prime, its Carmichael&rsquo;s $\lambda$ is equal to Euler&rsquo;s $\varphi$, which states</p>
<p>$$
\lambda(p)=\varphi(p)=p-1,\lambda(q)=\varphi(q)=q-1
$$</p>
<p>Let $d_p:\equiv d\pmod{\lambda(p)}$ and $d_q:\equiv d\pmod{\lambda(q)}$, this states $k_p,k_q\in\mathbb{Z}$ exist so that</p>
<p>$$
d=k_p\lambda(p)+d_p=k_q\lambda(q)+d_q,
$$</p>
<p>By applying Euler&rsquo;s theorem, the exponential part is reduced to $\eqref{crt-3}$</p>
<p>$$
\begin{equation}
\left\{
\begin{aligned}
x&amp;\equiv m^d\equiv m^{k_p\lambda(p)+d_p}\equiv m^{d_p}\pmod{p} \\
x&amp;\equiv m^d\equiv m^{k_q\lambda(q)+d_q}\equiv m^{d_q}\pmod{q}
\end{aligned}
\right.\label{crt-3}
\end{equation}
$$</p>
<p>The smaller exponents $d_p$ and $d_q$ are called <strong>exponent1</strong> and <strong>exponent2</strong> in the component list <a href="/2023/08/19/recovering-rsa-key-pair-with-cado-nfs/#private-key-components">above</a>, they are precomputed in the private key.</p>
<p>By applying CRT algorithm here, the solution is $\eqref{crt-4}$</p>
<p>$$
\begin{equation}
x\equiv m^{d_q} + q^*(m^{d_p}-m^{d_q})q \pmod{pq}\label{crt-4}
\end{equation}
$$</p>
<p>where $q^*:\equiv q^{-1} \pmod p$, and is called <strong>coefficient</strong> in the component list <a href="/2023/08/19/recovering-rsa-key-pair-with-cado-nfs/#private-key-components">above</a>.</p>
<p>In conclusion, those extra components are generally called CRT components:</p>
<ul>
<li><strong>exponent1</strong> (paired with <strong>prime1</strong> $p$) is $d_p:\equiv d\pmod{\lambda(p)}$, where $\lambda(p)=p-1$</li>
<li><strong>exponent2</strong> (paired with <strong>prime2</strong> $q$) is $d_q:\equiv d\pmod{\lambda(q)}$, where $\lambda(q)=q-1$</li>
<li><strong>coefficient</strong> is $q^*:\equiv q^{-1} \pmod p$</li>
</ul>
<h3 id="public-key-components">Public Key Components</h3>
<p>Derive the public key from previously generated private key, and inspect its components:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ openssl rsa -in sample.key -pubout <span class="p">|</span> openssl pkey -pubin -noout -text
</span></span><span class="line"><span class="cl">writing RSA key
</span></span><span class="line"><span class="cl">Public-Key: <span class="o">(</span><span class="m">512</span> bit<span class="o">)</span>
</span></span><span class="line"><span class="cl">Modulus:
</span></span><span class="line"><span class="cl">    00:e8:b1:ea:27:bc:3a:a6:9f:53:48:24:9c:5a:9d:
</span></span><span class="line"><span class="cl">    9e:64:af:12:3e:ae:db:46:f0:4d:99:55:61:fd:c2:
</span></span><span class="line"><span class="cl">    c8:45:35:25:05:e6:7b:37:c0:cc:92:7a:45:c0:5b:
</span></span><span class="line"><span class="cl">    01:a3:4c:4e:87:5b:70:48:62:05:2a:6e:c2:3a:6a:
</span></span><span class="line"><span class="cl">    f0:07:92:61:ad
</span></span><span class="line"><span class="cl">Exponent: <span class="m">65537</span> <span class="o">(</span>0x10001<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Public keys are simpler, and the list shows exactly the tuple $(N,e)$.</p>
<h1 id="recover-key-pair">Recover Key Pair</h1>
<p>The <a href="https://en.wikipedia.org/wiki/Trapdoor_function#RSA_Assumption">trapdoor</a> in RSA ensures that an attacker cannot recover the private key easily from a public key, unless they do know the factorization of the modulus i.e. $N=pq$. Looking up the factorization on <a href="http://factordb.com/">factordb</a> is always a good idea, but the successful cases are rare in real life.</p>
<p>If someone is using RSA-512, the attacker can spend <strong>less than a week</strong> to factorize the modulus stored in the public key with CADO-NFS software suite, which implements <abbr title="Number Field Sieve">NFS</abbr> algorithm.</p>
<h2 id="distributed-factorization">Distributed Factorization</h2>
<p>CADO-NFS supports a central server for distributed computation. Here are some additional tips:</p>
<ul>
<li>
<p>Use same Linux distro OR same Docker image on the server and clients, if distributed</p>
<p>Otherwise, you probably need to struggle with <code>glibc</code> version compatibility issues.</p>
</li>
<li>
<p>Pay attention to the output after CADO-NFS server starts up, which will contain a command for restoring progress, this is quite useful if the server accidentally exits.</p>
</li>
</ul>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>
<p>Aside from common toolchains, <code>cmake</code> and <code>libgmp3-dev</code> are required to build CADO-NFS.</p>
</li>
<li>
<p>Download CADO-NFS <a href="https://gitlab.inria.fr/cado-nfs/cado-nfs/-/archive/master/cado-nfs-master.tar.gz">source tarball</a>, extract and enter the directory.</p>
</li>
<li>
<p>Run <code>make -j8</code>. (adjust the job number to fit your workload)</p>
</li>
<li>
<p><code>./cado-nfs.py</code> and <code>./cado-nfs-client.py</code> are ready to use.</p>
</li>
<li>
<p>Get modulus and public exponent from public key <code>pub.pem</code>, some digits are redacted.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ openssl pkey -pubin -in pub.pem -noout -text
</span></span><span class="line"><span class="cl">Public-Key: <span class="o">(</span><span class="m">512</span> bit<span class="o">)</span>
</span></span><span class="line"><span class="cl">Modulus:
</span></span><span class="line"><span class="cl">    00:bc:dd:6e:bc:57:ae:a2:be:7d:ad:70:8f:71:0a:
</span></span><span class="line"><span class="cl">    80:86:3b:c5:18:f7:ab:4d:5e:bd:a5:64:b2:65:d2:
</span></span><span class="line"><span class="cl">    7c:d9:4c:5e:e3:c3:bc:33:b7:60:30:98:bd:6d:c4:
</span></span><span class="line"><span class="cl">    **:**:**:**:**:**:**:**:**:**:**:**:**:**:**:
</span></span><span class="line"><span class="cl">    **:**:**:**:**
</span></span><span class="line"><span class="cl">Exponent: <span class="m">65537</span> <span class="o">(</span>0x10001<span class="o">)</span>
</span></span><span class="line"><span class="cl">$ openssl rsa -pubin -in public.pem -noout -modulus 
</span></span><span class="line"><span class="cl"><span class="nv">Modulus</span><span class="o">=</span>BCDD6EBC57AEA2BE7DAD708F710A80863BC518F7AB4D5EBDA564B265D27CD94C5EE3C3BC33B7603098BD6DC4****************REDACTED****************
</span></span></code></pre></td></tr></table>
</div>
</div><p>You just need to convert the hexadecimal form into decimal number, for example evaluate it directly in Python</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python -c <span class="s2">&#34;print(0xBCDD6EBC57AEA2BE7DAD708F710A80863BC518F7AB4D5EBDA564B265D27CD94C5EE3C3BC33B7603098BD6DC4****************REDACTED****************)&#34;</span>
</span></span><span class="line"><span class="cl">9891661152720289911993780388856560399924301310754393756699908896661301299157403390541217712185535804***********************REDACTED***********************
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="server">Server</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./cado-nfs.py 9891661152720289911993780388856560399924301310754393756699908896661301299157403390541217712185535804***********************REDACTED*********************** <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>              server.ssl<span class="o">=</span>no server.address<span class="o">=</span>0.0.0.0 server.port<span class="o">=</span><span class="m">52600</span> server.whitelist<span class="o">=</span>0.0.0.0/0 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>              tasks.workdir<span class="o">=</span><span class="nv">$HOME</span>/nfs-work <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>              --server
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="clients">Clients</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./cado-nfs-client.py --server<span class="o">=</span>http://server:52600 --override -t <span class="m">8</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Change <code>server</code> to your server address and modify <code>--override -t 8</code> to override the thread number on different clients.</p>
<h3 id="result">Result</h3>
<p>The final output will be just two primes, as shown below.</p>
<pre tabindex="0"><code>95488332303787905388806934005632272891519544646395*************************** 103590259815731432651796987187054092306262180182970***************************
</code></pre><center>
<figure><img src="/2023/08/19/recovering-rsa-key-pair-with-cado-nfs/factorization.png"><figcaption>
      <h4>Factorization Result</h4>
    </figcaption>
</figure>

</center>
<h2 id="construct-private-key">Construct Private Key</h2>
<p>To construct a private key with CRT components easily, I recommend to use <a href="https://github.com/ius/rsatool"><code>rsatool.py</code></a>.</p>
<p>You&rsquo;ll need to clone the repository and run <code>pip install .</code> in its directory first.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python rsatool.py -n 9891661152720289911993780388856560399924301310754393756699908896661301299157403390541217712185535804***********************REDACTED*********************** <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                    -p 95488332303787905388806934005632272891519544646395*************************** <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                    -q 103590259815731432651796987187054092306262180182970*************************** <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                    -e <span class="m">65537</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                    -f PEM -o recovered.key
</span></span><span class="line"><span class="cl">Using <span class="o">(</span>p, q<span class="o">)</span> to calculate RSA paramaters
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">n</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">bcdd6ebc57aea2be7dad708f710a80863bc518f7ab4d5ebda564b265d27cd94c5ee3c3bc33b76030
</span></span><span class="line"><span class="cl">********************redacted********************
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">e</span> <span class="o">=</span> <span class="m">65537</span> <span class="o">(</span>0x10001<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">d</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">5d9b5a611b0c41392ccd23b6d48e21f965f26057909dbe513c825631454bffde921bc51a076cc3a5
</span></span><span class="line"><span class="cl">********************redacted********************
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">p</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">d31c7b17003dec91c9709546264c76c94670a4a9********redacted********
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">q</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">e506026099230459a9a042fac22b258da1c43647********redacted********
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Saving PEM as recovered.key
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now the private key is recovered and ready to use. This tool creates keys in PKCS#1 format. To convert it to PKCS#8 format, simply run</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ openssl pkey -in recovered.key
</span></span></code></pre></td></tr></table>
</div>
</div><!-- # Appendix: Carmichael vs. Euler -->

    </article>
  </main>
  

<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/tex-mml-chtml.js">
</script>
<script>
    MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            displayMath: [['$$', '$$'], ['\\[', '\\]']],
            tags: 'ams',
        }
    };
</script>







<div id="comment"></div>










<div id="disqus_thread" class="mt-8 mb-8"></div>
<script type="text/javascript">
    
    
    if (window.location.hostname == "localhost") {
        
        
    } else {
        const dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;

        const disqus_shortname = 'y5c4l3';
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        document.getElementById("comment").appendChild(dsq);
    }
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by
        Disqus.</a></noscript>



</div>


  <footer class="mt-8 mb-8">
  <div class="container mx-auto">
    <div class="mt-8 flex justify-between items-center">
      <p class="mt-0 text-sm">
        ¬© 2024 y5c4l3 |
        <a href="https://gohugo.io" target="_blank" rel="noopener noreferrer">Hugo</a> on
        <a href="https://github.com/mivinci/hugo-theme-minima" target="_blank" rel="noopener noreferrer">Minima</a>
      </p>
      <p class="flex items-center mt-0">
        
          <a class="icon ml-1 mr-1" href="mailto:y5c4l3@proton.me" title="email">
          
            <svg fill="#63636f" width="22" height="22" viewBox="0 0 24 24"><path d="M3 3h18a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zm9.06 8.683L5.648 6.238L4.353 7.762l7.72 6.555l7.581-6.56l-1.308-1.513l-6.285 5.439z"/></svg>
          
          </a>
        
          <a class="icon ml-1 mr-1" href="https://github.com/y5c4l3" title="github">
          
            <svg fill="#63636f" width="18" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
          
          </a>
        
          <a class="icon ml-1 mr-1" href="/index.xml" title="rss">
          
            <svg fill="#63636f" t="1626591563876" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1984" width="18" height="16"><path d="M128 768a128 128 0 1 0 0 256 128 128 0 0 0 0-256zM0 368v176c265.104 0 480 214.912 480 480h176c0-362.32-293.696-656-656-656zM0 0v176c468.336 0 848 379.664 848 848h176C1024 458.464 565.536 0 0 0z" p-id="1985"></path></svg>
          
          </a>
        
      </p>
    </div>
  </div>
</footer>
</body>

</html>